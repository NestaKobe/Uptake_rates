---
title: "Weekly feeback"
author: "Simon Coburg; IMBRSea 20191199 - CCMAR a73216"
date: "23/04/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
### Thesis "Seagrass domination over seaweeds in oligotrophic coastal ecosystems"

<font size="3"> with supervisors: *[Ana Alexandre](https://www.ccmar.ualg.pt/users/aalexandre), [Carmen de los Santos](https://www.ccmar.ualg.pt/users/cbsantos) & [Rui Santos](https://www.ccmar.ualg.pt/users/rosantos), CCMAR* </font>

---

*R script - [GitHub](https://github.com/NestaKobe/Uptake_rates)*

---

PRISMA protocol step **Eligibility**

*of full-text articles assessed for eligibility:* 344

- total studies assessed at present: 78

- of full-text articles excluded with reasons: 15

- of full-text articles on waiting list: 22

- <u> of studies included in qualitative synthesis: 40 </u>


### Exploratory data analysis  
```{r loading libraries, include=FALSE}

# load libraries
packages <- c("tidyverse",      # for data science (general) - includes ggplot2
              "readxl")         # for reading xlsx files

for (i in seq_along(packages)) {
  if(!do.call(require, list(package = packages[i]))) {
    do.call(install.packages, list(pkgs = packages[i]))
    do.call(require, list(package = packages[i]))
  }
}

# set working directory
setwd("~/Documents/IMBRSea/Thesis S4/Rstudio Uptake rates")
```
<br>

#### 1. Loading data and examine data structure
```{r loading data, include=TRUE}

# load SOURCES
data.sou  <- read_excel("~/Documents/IMBRSea/Thesis S4/Database uptake rate_23.04.2021.xlsx",
                        sheet="sources",na="NA",skip=3)

str(data.sou)
names(data.sou)

# load ENVIRONMENTAL
data.env  <- read_excel("~/Documents/IMBRSea/Thesis S4/Database uptake rate_23.04.2021.xlsx",
                        sheet="environmental",na="NA",skip=3)
str(data.env)
names(data.env)

# load EXPERIMENTAL
data.exp  <- read_excel("~/Documents/IMBRSea/Thesis S4/Database uptake rate_23.04.2021.xlsx",
                        sheet="experimental",na="NA",skip=3)
str(data.exp)
names(data.exp)
```
<br>

Transforming columns *Vmax, Km, alpha and Sampling_inter* from CHR to NUM
```{r converting numeric, warning=FALSE}

data.exp$Vmax   <- as.numeric(data.exp$Vmax)
data.exp$Km     <- as.numeric(data.exp$Km)
data.exp$alpha  <- as.numeric(data.exp$alpha)
data.exp$sampling_inter <- as.numeric(data.exp$sampling_inter)

```
<br>

Quality controls for ENVIRONMENTAL/EXPERIMENTAL
```{r}
length(unique(data.env$id_short))
length(unique(data.exp$id_short))
```
<br>

#### 2. Explore datasets
<br>

**Publication type**

```{r publication type, echo=FALSE}
ggplot(data.sou, aes(x=publication_type)) +
        geom_bar(stat="count", width = .5) +
        theme_bw()
```

**Publication year**

```{r publication year, echo=FALSE}
ggplot(data.sou, aes(x=year)) +
        geom_bar(stat="count") +
        theme_bw()
```

**Sampling locations**

```{r sampling location, echo=FALSE}
ggplot(data.env, aes(x=sample_country)) +
        geom_bar(stat="count", na.rm=FALSE) + coord_flip() +
        theme_bw() +
        theme(axis.text.x = element_text(angle=0, vjust=0.5, hjust=1))
```

*-- ANNOTATION: Carmen would you know how to adjust the count per country in ENV by publication and not by the total of countries registered in the column *sample_country*? --*

**Species type**

```{r species type, echo=FALSE}
ggplot(data.exp, aes(x=species_type)) +
        geom_bar(stat="count",  width = .5) +
        geom_text(aes(label = ..count..), stat = "count", vjust = 1.5, colour = "white") +
        theme_bw()

ggplot(data.exp, aes(x=species_type, fill=species_phyla)) +
        scale_fill_manual(values = c("forestgreen", "salmon4", "red2", "springgreen4")) +
        geom_bar(stat="count", position=position_dodge(),  width = .6) +
        #geom_text(aes(label = ..count..), stat = "count", vjust = .5, colour = "black") +
        theme_bw() +
        theme(legend.position="right")

ggplot(data.exp, aes(x=species_type, colour=species_compartm, fill=species_compartm)) +
        geom_bar(stat="count", position=position_dodge()) +
        #geom_text(aes(label = ..count..), stat = "count", vjust = .5, colour = "black") +
        theme_bw() +
        theme(legend.position="right")

```
<br>

**Composition of registered uptake rate values**
```{r incubation type, echo=FALSE, warning=FALSE}
#Incubation type / surge or int. contr. phase
ggplot(data.exp, aes(x=Vmax))+
  geom_histogram(binwidth=10) +
  facet_grid(type_incub~species_type) +
  theme_bw()
```
<br>

<br>

#### Following *Vmax* values are portrayed for the type of incubation; Range or single
<br>

##### **Range Vmax**

**by species type**

```{r Vmax range, echo=FALSE, warning=FALSE}
#Distribution - Hist
ggplot(data.exp, aes(x=Vmax))+
        geom_histogram(binwidth=10) +
        facet_grid(.~species_type) +
        theme_bw()
```

**by species type & compartment**

```{r compartment, echo=FALSE, warning=FALSE}
ggplot(data.exp, aes(x=Vmax))+
  geom_histogram(binwidth=10) +
  facet_grid(species_compartm~species_type) +
  theme_bw()
```

**by species type & temperature**

```{r temperature, echo=FALSE, warning=FALSE}
#Scatterplot for temperature
ggplot(data.exp, aes(x=temperature_experiment, y=Vmax)) +
  geom_point() +
  facet_grid(.~species_type) +
  theme_bw()
```

**by species type & nutrient**

```{r nutrient, echo=FALSE, warning=FALSE}
ggplot(data.exp, aes(x=species_type, y=Vmax)) +
        geom_boxplot() +
        geom_jitter() +
        facet_grid(.~nutrient) +
        theme_bw()
```
<br>

<br>


##### **Single Vmax**

**by species type**

```{r Vmax single, echo=FALSE, warning=FALSE}
#Distribution - Hist
ggplot(data.exp, aes(x=uptake_rate_dw))+
  geom_histogram(binwidth=10) +
  facet_grid(.~species_type) +
  theme_bw()
```

**by species type & compartment**

```{r compartment single, echo=FALSE, warning=FALSE}
ggplot(data.exp, aes(x=uptake_rate_dw))+
  geom_histogram(binwidth=10) +
  facet_grid(species_compartm~species_type) +
  theme_bw()
```

**by Internally controlled phase / Surge uptake**

```{r surge single, echo=FALSE, warning=FALSE}
#Vmax for int. contr. phase / surge
ggplot(data=subset(data.exp, !is.na(uptake_rate_dw)), aes(x=uptake_rate_dw))+
  geom_histogram(binwidth=10) +
  facet_grid(type_uptake~species_type) +
  theme_bw()
```

**by species type & temperature**

```{r temperature single, echo=FALSE, warning=FALSE}
ggplot(data.exp, aes(x=temperature_experiment, y=uptake_rate_dw)) +
  geom_point() +
  facet_grid(.~species_type) +
  theme_bw()
```

**by species type & nutrient**

```{r nutrient single, echo=FALSE, warning=FALSE}
ggplot(data.exp, aes(x=species_type, y=uptake_rate_dw)) +
        geom_boxplot() +
        geom_jitter() +
        facet_grid(.~nutrient) +
        theme_bw()
```
<br>
